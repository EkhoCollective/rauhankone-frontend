import{f as te,a as T,e as G,t as I,b as z,d as W,s as oe,i as Ce}from"../chunks/CDB5auML.js";import{b as ke,h as E,a as we,aM as ue,f as Ve,g as Ee,s as Ne,i as de,U as ee,aj as J,k as fe,c as D,q as Me,d as Le,ax as ve,aw as _e,aN as me,aI as Fe,j as ge,p as R,T as je,B as he,a0 as Se,aO as Oe,aP as De,R as H,J as U,K as p,O as m,Q as P,M as ae,N as X,m as o,X as pe,Z as C,A as k,Y as Re}from"../chunks/BnZ242CD.js";import{i as re}from"../chunks/7GCewVbm.js";import{X as qe,a as ze,b as A,c as N,s as Ge,t as be,d as He,A as Ue,C as Xe,e as Ye}from"../chunks/DDKGy3xQ.js";import{I as ne,s as se,a as Ze,i as Be,t as M,b as Je,e as Ke,f as j}from"../chunks/BYK1wCTk.js";import{_ as Y}from"../chunks/Dp1pzeXC.js";import{r as Z,b as Te,g as Qe,$ as xe,a as ye,w as Ie}from"../chunks/CODNnVm9.js";import{p as le}from"../chunks/BgM62gPE.js";import{c as We}from"../chunks/BfDrnOOI.js";import{l as ie,s as ce,p as q}from"../chunks/CbChFFX3.js";import{C as ea}from"../chunks/CusLCczS.js";import{b as Ae,g as aa}from"../chunks/DpYOH06s.js";const K=0,O=1,Q=2;function ta(u,e,r,g,v){E&&we();var l=u,c=Se(),f=Fe,n=ee,i,a,_,L=(c?fe:he)(void 0),$=(c?fe:he)(void 0),S=!1;function y(t,b){S=!0,b&&(ve(d),_e(d),me(f));try{t===K&&r&&(i?ge(i):i=D(()=>r(l))),t===O&&g&&(a?ge(a):a=D(()=>g(l,L))),t!==K&&i&&R(i,()=>i=null),t!==O&&a&&R(a,()=>a=null),t!==Q&&_&&R(_,()=>_=null)}finally{b&&(me(null),_e(null),ve(null),je())}}var d=ke(()=>{if(n===(n=e()))return;let t=E&&ue(n)===(l.data===Ve);if(t&&(l=Ee(),Ne(l),de(!1),t=!0),ue(n)){var b=n;S=!1,b.then(h=>{b===n&&(J(L,h),y(O,!0))},h=>{if(b===n)throw J($,h),y(Q,!0),$.v}),E?r&&(i=D(()=>r(l))):Me(()=>{S||y(K,!0)})}else J(L,n),y(O,!1);return t&&de(!0),()=>n=ee});E&&(l=Le)}function oa(u,e,r){E&&we();var g=u,v=ee,l,c=Se()?Oe:De;ke(()=>{c(v,v=e())&&(l&&R(l),l=D(()=>r(g)))}),E&&(g=Le)}const ra=!0,Da=Object.freeze(Object.defineProperty({__proto__:null,prerender:ra},Symbol.toStringTag,{value:"Module"})),$e="en";Z("en",()=>Y(()=>import("../chunks/Qyax1cwP.js"),[],import.meta.url));Z("fi",()=>Y(()=>import("../chunks/BRpihtYY.js"),[],import.meta.url));Z("sv",()=>Y(()=>import("../chunks/UR3G0BYx.js"),[],import.meta.url));Z("sa",()=>Y(()=>import("../chunks/-XYQ1-VA.js"),[],import.meta.url));Te({fallbackLocale:$e,initialLocale:Qe()||$e});async function na(){try{const e=await fetch("https://peacemachine.eu/auth/app-token",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Error ${e.status}: ${await e.text()}`);const r=await e.json();return localStorage.setItem("accessToken",r.access_token),localStorage.setItem("refreshToken",r.refresh_token),r}catch(u){return console.error("Error getting auth token:",u),null}}function sa(u,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);ne(u,ce({name:"globe"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(v,l)=>{var c=te(),f=H(c);se(f,e,"default",{}),T(v,c)},$$slots:{default:!0}}))}function la(u,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);ne(u,ce({name:"volume-2"},()=>r,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["path",{d:"M16 9a5 5 0 0 1 0 6"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728"}]],children:(v,l)=>{var c=te(),f=H(c);se(f,e,"default",{}),T(v,c)},$$slots:{default:!0}}))}function ia(u,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);ne(u,ce({name:"volume-x"},()=>r,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15"}]],children:(v,l)=>{var c=te(),f=H(c);se(f,e,"default",{}),T(v,c)},$$slots:{default:!0}}))}var ca=(u,e)=>e.closeLangCard(),ua=(u,e,r)=>e(r()),da=I("<button> </button>"),fa=I('<div class="card-lang-container svelte-dj9995"><div class="card-header-container svelte-dj9995"><button class="btn btn-close svelte-dj9995"><!></button></div> <div class="card-btn-container svelte-dj9995"></div> <div class="card-extra-container svelte-dj9995"><div class="card-checkmark-container svelte-dj9995"><!></div> <div> </div></div></div>');function va(u,e){U(e,!0);const[r,g]=oe(),v=()=>z(ye,"$locale",r),l=()=>z(xe,"$_",r);let c=q(e,"translate",15);const f=[{code:"en",name:"English"},{code:"fi",name:"Suomi"},{code:"sv",name:"Svenska"},{code:"sa",name:"SÃ¡megiella"}];async function n(h){ye.set(h),localStorage.setItem("locale",h),await Ie().then(()=>{e.closeLangCard(!1)})}var i=fa(),a=p(i),_=p(a);_.__click=[ca,e];var L=p(_);qe(L,{color:"#ffffff"}),m(_),m(a);var $=P(a,2);Ze($,21,()=>f,Be,(h,s)=>{let w=()=>o(s).code,V=()=>o(s).name;var x=da();let F;x.__click=[ua,n,w];var B=p(x,!0);m(x),ae(Pe=>{F=We(x,1,"btn btn-lang svelte-dj9995",null,F,Pe),W(B,V())},[()=>({"active-lang":v()===w()})]),T(h,x)}),m($);var S=P($,2),y=p(S),d=p(y);ea(d,{get checkValue(){return c()},set checkValue(h){c(h)}}),m(y);var t=P(y,2),b=p(t,!0);m(t),m(S),m(i),ae(h=>W(b,h),[()=>l()("header_btn_translate_all")]),T(u,i),X(),g()}G(["click"]);G(["click"]);var _a=(u,e)=>e(),ma=I('<div class="audio-icon-container svelte-1hhaios"><button class="btn svelte-1hhaios"><!></button></div>');function ga(u,e){U(e,!0);const[r,g]=oe(),v=()=>z(ze,"$audioStore",r);let l=q(e,"volume",11,.3),c=q(e,"clusterVolume",11,1),f=q(e,"fadeTime",11,500),n=C(0),i=C(-1),a=C(null),_=!1;async function L(){if(!_)try{_=!0;const w=!v().isGloballyMuted;if(A.setMuted(w),w){if(o(a)){const V=isFinite(f())?f():500;await N.fadeOut(o(a),V),A.setPlayingState("paused")}Ge.stopAllEffects()}else await $()}finally{_=!1}}async function $(){if(!(o(a)&&o(i)===o(n)&&!o(a).paused)){o(a)&&(N.cancelFade(o(a)),o(a).pause(),k(a,null));try{const s=isFinite(l())?l():.3,w=isFinite(f())?f():500;k(a,new Audio(be[o(n)].src),!0),o(a).loop=!0,o(a).volume=0,await o(a).play(),await N.fadeIn(o(a),s,w),k(i,o(n),!0),A.setCurrentSong(o(a)),A.setPlayingState("playing"),A.setVolume(s)}catch(s){console.error("Failed to start playing song:",s),k(a,null),k(i,-1),A.setPlayingState("paused")}}}async function S(){if(!(!o(a)||_)){_=!0;try{const s=o(a),w=isFinite(l())?l():.3,V=isFinite(f())?f():500,x=new Audio(be[o(n)].src);x.loop=!0,x.volume=0,await x.play();const F=N.fadeOut(s,V*.7),B=N.fadeIn(x,w,V*.7);await Promise.all([F,B]),k(a,x,!0),k(i,o(n),!0),A.setCurrentSong(x),A.setVolume(w)}catch(s){console.error("Cross-fade failed:",s),await $()}finally{_=!1}}}pe(()=>{const s=le.url.pathname==="/explore"?1:0;s!==o(n)&&!v().isGloballyMuted&&v().playingState==="playing"&&o(a)&&!_?(o(n),k(n,s,!0),S().catch(w=>{console.error("Failed to cross-fade to new song:",w),k(n,s,!0)})):k(n,s,!0)}),pe(()=>{const s=isFinite(c())?c():1;He.setClusterVolume(s)});var y=ma(),d=p(y);d.__click=[_a,L];var t=p(d);{var b=s=>{ia(s,{color:"#ffffff"})},h=s=>{la(s,{color:"#ffffff"})};re(t,s=>{v().isGloballyMuted?s(b):s(h,!1)})}m(d),m(y),T(u,y),X(),g()}G(["click"]);var ha=()=>aa(`${Ae}/`),pa=I('<div class="back-btn-container svelte-o4wwt4"><button class="btn svelte-o4wwt4"><!> </button></div>'),ba=(u,e)=>e.toggleLang(),ya=I('<div class="card-header-container svelte-o4wwt4"><!> <div class="lang-btn-container svelte-o4wwt4"><button class="btn svelte-o4wwt4"><!></button></div> <div class="audio-control-container svelte-o4wwt4"><!></div></div>');function $a(u,e){U(e,!0);const[r,g]=oe(),v=()=>z(xe,"$_",r);let l=C(.5),c=C(1),f=C(500);var n=ya(),i=p(n);{var a=d=>{var t=pa(),b=p(t);b.__click=[ha];var h=p(b);Ue(h,{color:"#ffffff"});var s=P(h);m(b),m(t),ae(w=>W(s,` ${w??""}`),[()=>v()("header_btn_exit")]),M(3,t,()=>Je),T(d,t)};re(i,d=>{le.url.pathname===`${Ae}/explore`&&d(a)})}var _=P(i,2),L=p(_);L.__click=[ba,e];var $=p(L);sa($,{color:"#ffffff"}),m(L),m(_);var S=P(_,2),y=p(S);ga(y,{get volume(){return o(l)},set volume(d){k(l,d,!0)},get fadeTime(){return o(f)},set fadeTime(d){k(f,d,!0)},get clusterVolume(){return o(c)},set clusterVolume(d){k(c,d,!0)}}),m(S),m(n),T(u,n),X(),g()}G(["click"]);var ka=I('<link rel="icon" type="image/svg" href="/favicon.ico">'),wa=I('<div class="lang-container svelte-eqtc25"><!></div>'),La=I('<div class="page-container"><!></div>'),Sa=I('<!> <div class="header-container svelte-eqtc25"><!></div> <!>',1),Ta=I('<div class="app svelte-eqtc25"><!></div>');function Ra(u,e){U(e,!0);let r=C(!1),g=500,v=C(!1);Te({fallbackLocale:"en",initialLocale:"en"});async function l(){await na().catch(i=>{throw Ke(500,"Failed to get token")})}let c=()=>{k(r,!o(r))};Re(()=>{window.scrollTo(0,0),l()});var f=Ta();Ce(i=>{var a=ka();T(i,a)});var n=p(f);ta(n,Ie,i=>{Xe(i)},i=>{var a=Sa(),_=H(a);{var L=d=>{var t=wa(),b=p(t);va(b,{closeLangCard:c,get translate(){return o(v)},set translate(h){k(v,h,!0)}}),m(t),M(1,t,()=>j,()=>({duration:g})),M(2,t,()=>j,()=>({duration:g})),T(d,t)};re(_,d=>{o(r)&&d(L)})}var $=P(_,2),S=p($);$a(S,{toggleLang:c}),m($);var y=P($,2);oa(y,()=>le.url.pathname,d=>{var t=La(),b=p(t);Ye(b,()=>e.children),m(t),M(1,t,()=>j,()=>({duration:g})),M(2,t,()=>j,()=>({duration:g})),T(d,t)}),T(i,a)}),m(f),T(u,f),X()}export{Ra as component,Da as universal};
