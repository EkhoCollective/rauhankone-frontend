import{f as ae,a as L,e as H,t as P,b as G,d as W,s as oe,i as Ce}from"../chunks/Db3oIwbZ.js";import{b as we,h as N,a as Se,aN as ue,f as Ne,g as Oe,s as Ve,i as de,U as ee,ak as Z,A as fe,c as D,q as Fe,d as Te,ay as ve,ax as _e,aO as me,aJ as Me,j as ge,p as j,T as qe,y as he,a0 as Le,aP as De,aQ as je,R as z,J as U,K as p,O as h,Q as C,M as te,N as Q,m as o,X as pe,Z as x,v as S,aR as Re,Y as Ge}from"../chunks/CTMOzZ3r.js";import{i as re}from"../chunks/Ww62Dn4U.js";import{X as He,a as ze,b as E,c as O,s as Ue,t as ye,d as Qe,A as Ye,C as Je,e as Xe}from"../chunks/BeHVjnDd.js";import{I as ne,s as se,c as Ze,i as Be,t as V,b as Ke,e as be,a as We,f as M}from"../chunks/BzgJNpeS.js";import{_ as Y}from"../chunks/Dp1pzeXC.js";import{r as J,b as Ie,g as et,$ as Pe,a as $e,w as xe}from"../chunks/D0Kfuxqv.js";import{p as le}from"../chunks/BphMRhFA.js";import{c as tt}from"../chunks/DmCIttcg.js";import{l as ie,s as ce,p as R}from"../chunks/B7_nHFhb.js";import{C as at}from"../chunks/oppZ5C8k.js";import{b as Ae,g as ot}from"../chunks/DQEsUoi3.js";const B=0,q=1,K=2;function rt(l,e,r,y,i){N&&Se();var s=l,c=Le(),_=Me,n=ee,d,a,m,g=(c?fe:he)(void 0),$=(c?fe:he)(void 0),T=!1;function k(v,w){T=!0,w&&(ve(f),_e(f),me(_));try{v===B&&r&&(d?ge(d):d=D(()=>r(s))),v===q&&y&&(a?ge(a):a=D(()=>y(s,g))),v!==B&&d&&j(d,()=>d=null),v!==q&&a&&j(a,()=>a=null),v!==K&&m&&j(m,()=>m=null)}finally{w&&(me(null),_e(null),ve(null),qe())}}var f=we(()=>{if(n===(n=e()))return;let v=N&&ue(n)===(s.data===Ne);if(v&&(s=Oe(),Ve(s),de(!1),v=!0),ue(n)){var w=n;T=!1,w.then(u=>{w===n&&(Z(g,u),k(q,!0))},u=>{if(w===n)throw Z($,u),k(K,!0),$.v}),N?r&&(d=D(()=>r(s))):Fe(()=>{T||k(B,!0)})}else Z(g,n),k(q,!1);return v&&de(!0),()=>n=ee});N&&(s=Te)}function nt(l,e,r){N&&Se();var y=l,i=ee,s,c=Le()?De:je;we(()=>{c(i,i=e())&&(s&&j(s),s=D(()=>r(y)))}),N&&(y=Te)}const st=!0,Rt=Object.freeze(Object.defineProperty({__proto__:null,prerender:st},Symbol.toStringTag,{value:"Module"})),ke="en";J("en",()=>Y(()=>import("../chunks/ICEdU12j.js"),[],import.meta.url));J("fi",()=>Y(()=>import("../chunks/CH3oJwPu.js"),[],import.meta.url));J("sv",()=>Y(()=>import("../chunks/D2SZLOoF.js"),[],import.meta.url));J("sa",()=>Y(()=>import("../chunks/DS1uFp8_.js"),[],import.meta.url));Ie({fallbackLocale:ke,initialLocale:et()||ke});async function lt(){try{const e=await fetch("https://peacemachine.eu/auth/app-token",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Error ${e.status}: ${await e.text()}`);const r=await e.json();return localStorage.setItem("accessToken",r.access_token),localStorage.setItem("refreshToken",r.refresh_token),r}catch(l){return console.error("Error getting auth token:",l),null}}function it(l,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);ne(l,ce({name:"globe"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(i,s)=>{var c=ae(),_=z(c);se(_,e,"default",{}),L(i,c)},$$slots:{default:!0}}))}function ct(l,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);ne(l,ce({name:"volume-2"},()=>r,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["path",{d:"M16 9a5 5 0 0 1 0 6"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728"}]],children:(i,s)=>{var c=ae(),_=z(c);se(_,e,"default",{}),L(i,c)},$$slots:{default:!0}}))}function ut(l,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);ne(l,ce({name:"volume-x"},()=>r,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15"}]],children:(i,s)=>{var c=ae(),_=z(c);se(_,e,"default",{}),L(i,c)},$$slots:{default:!0}}))}var dt=(l,e)=>e.closeLangCard(),ft=(l,e,r)=>e(r()),vt=P("<button> </button>"),_t=P('<div class="card-lang-container svelte-dj9995"><div class="card-header-container svelte-dj9995"><button class="btn btn-close svelte-dj9995"><!></button></div> <div class="card-btn-container svelte-dj9995"></div> <div class="card-extra-container svelte-dj9995"><div class="card-checkmark-container svelte-dj9995"><!></div> <div> </div></div></div>');function mt(l,e){U(e,!0);const[r,y]=oe(),i=()=>G($e,"$locale",r),s=()=>G(Pe,"$_",r);let c=R(e,"translate",15);const _=[{code:"en",name:"English"},{code:"fi",name:"Suomi"},{code:"sv",name:"Svenska"},{code:"sa",name:"SÃ¡megiella"}];async function n(u){$e.set(u),localStorage.setItem("locale",u),await xe().then(()=>{e.closeLangCard(!1)})}var d=_t(),a=p(d),m=p(a);m.__click=[dt,e];var g=p(m);He(g,{color:"#ffffff"}),h(m),h(a);var $=C(a,2);Ze($,21,()=>_,Be,(u,t)=>{let b=()=>o(t).code,A=()=>o(t).name;var I=vt();let F;I.__click=[ft,n,b];var X=p(I,!0);h(I),te(Ee=>{F=tt(I,1,"btn btn-lang svelte-dj9995",null,F,Ee),W(X,A())},[()=>({"active-lang":i()===b()})]),L(u,I)}),h($);var T=C($,2),k=p(T),f=p(k);at(f,{get checkValue(){return c()},set checkValue(u){c(u)}}),h(k);var v=C(k,2),w=p(v,!0);h(v),h(T),h(d),te(u=>W(w,u),[()=>s()("btn_translate_check")]),L(l,d),Q(),y()}H(["click"]);H(["click"]);var gt=(l,e)=>e(),ht=P('<div class="audio-icon-container svelte-1hhaios"><button class="btn svelte-1hhaios"><!></button></div>');function pt(l,e){U(e,!0);const[r,y]=oe(),i=()=>G(ze,"$audioStore",r);let s=R(e,"volume",11,.3),c=R(e,"clusterVolume",11,1),_=R(e,"fadeTime",11,500),n=x(0),d=x(-1),a=x(null),m=!1;async function g(){if(!m)try{m=!0;const b=!i().isGloballyMuted;if(E.setMuted(b),b){if(o(a)){const A=isFinite(_())?_():500;await O.fadeOut(o(a),A),E.setPlayingState("paused")}Ue.stopAllEffects()}else await $()}finally{m=!1}}async function $(){if(!(o(a)&&o(d)===o(n)&&!o(a).paused)){o(a)&&(O.cancelFade(o(a)),o(a).pause(),S(a,null));try{const t=isFinite(s())?s():.3,b=isFinite(_())?_():500;S(a,new Audio(ye[o(n)].src),!0),o(a).loop=!0,o(a).volume=0,await o(a).play(),await O.fadeIn(o(a),t,b),S(d,o(n),!0),E.setCurrentSong(o(a)),E.setPlayingState("playing"),E.setVolume(t)}catch(t){console.error("Failed to start playing song:",t),S(a,null),S(d,-1),E.setPlayingState("paused")}}}async function T(){if(!(!o(a)||m)){m=!0;try{const t=o(a),b=isFinite(s())?s():.3,A=isFinite(_())?_():500,I=new Audio(ye[o(n)].src);I.loop=!0,I.volume=0,await I.play();const F=O.fadeOut(t,A*.7),X=O.fadeIn(I,b,A*.7);await Promise.all([F,X]),S(a,I,!0),S(d,o(n),!0),E.setCurrentSong(I),E.setVolume(b)}catch(t){console.error("Cross-fade failed:",t),await $()}finally{m=!1}}}pe(()=>{const t=le.url.pathname==="/explore"?1:0;t!==o(n)&&!i().isGloballyMuted&&i().playingState==="playing"&&o(a)&&!m?(o(n),S(n,t,!0),T().catch(b=>{console.error("Failed to cross-fade to new song:",b),S(n,t,!0)})):S(n,t,!0)}),pe(()=>{const t=isFinite(c())?c():1;Qe.setClusterVolume(t)});var k=ht(),f=p(k);f.__click=[gt,g];var v=p(f);{var w=t=>{ut(t,{color:"#ffffff"})},u=t=>{ct(t,{color:"#ffffff"})};re(v,t=>{i().isGloballyMuted?t(w):t(u,!1)})}h(f),h(k),L(l,k),Q(),y()}H(["click"]);var yt=()=>ot(`${Ae}/`),bt=P('<div class="back-btn-container svelte-o4wwt4"><button class="btn svelte-o4wwt4"><!> </button></div>'),$t=(l,e)=>e.toggleLang(),kt=P('<div class="card-header-container svelte-o4wwt4"><!> <div class="lang-btn-container svelte-o4wwt4"><button class="btn svelte-o4wwt4"><!></button></div> <div class="audio-control-container svelte-o4wwt4"><!></div></div>');function wt(l,e){U(e,!0);const[r,y]=oe(),i=()=>G(Pe,"$_",r);let s=x(.5),c=x(1),_=x(500);var n=kt(),d=p(n);{var a=f=>{var v=bt(),w=p(v);w.__click=[yt];var u=p(w);Ye(u,{color:"#ffffff"});var t=C(u);h(w),h(v),te(b=>W(t,` ${b??""}`),[()=>i()("btn_exit")]),V(3,v,()=>Ke),L(f,v)};re(d,f=>{le.url.pathname===`${Ae}/explore`&&f(a)})}var m=C(d,2),g=p(m);g.__click=[$t,e];var $=p(g);it($,{color:"#ffffff"}),h(g),h(m);var T=C(m,2),k=p(T);pt(k,{get volume(){return o(s)},set volume(f){S(s,f,!0)},get fadeTime(){return o(_)},set fadeTime(f){S(_,f,!0)},get clusterVolume(){return o(c)},set clusterVolume(f){S(c,f,!0)}}),h(T),h(n),L(l,n),Q(),y()}H(["click"]);var St=P('<link rel="icon" type="image/svg" href="/favicon.ico">'),Tt=P('<div class="lang-container svelte-eqtc25"><!></div>'),Lt=P('<div class="page-container"><!></div>'),It=P('<!> <div class="header-container svelte-eqtc25"><!></div> <!>',1),Pt=P('<div class="app svelte-eqtc25"><!></div>');function Gt(l,e){U(e,!0);let r=x(null),y=x(!1),i=500,s=x(!1);Re("questions",()=>o(r)),Ie({fallbackLocale:"en",initialLocale:"en"});const c=()=>({API_ENDPOINT:"/get_questions",API_METHOD:"POST",REQUEST_BODY:{question_type:"starter"}});async function _(){await lt().then(()=>{n()}).catch(g=>{throw be(500,"Failed to get token")})}async function n(){await We(c()).then(g=>{S(r,g,!0)}).catch(g=>{throw be(500,"Failed to get questions")})}let d=()=>{S(y,!o(y))};Ge(()=>{window.scrollTo(0,0),_()});var a=Pt();Ce(g=>{var $=St();L(g,$)});var m=p(a);rt(m,xe,g=>{Je(g)},g=>{var $=It(),T=z($);{var k=u=>{var t=Tt(),b=p(t);mt(b,{closeLangCard:d,get translate(){return o(s)},set translate(A){S(s,A,!0)}}),h(t),V(1,t,()=>M,()=>({duration:i})),V(2,t,()=>M,()=>({duration:i})),L(u,t)};re(T,u=>{o(y)&&u(k)})}var f=C(T,2),v=p(f);wt(v,{toggleLang:d}),h(f);var w=C(f,2);nt(w,()=>le.url.pathname,u=>{var t=Lt(),b=p(t);Xe(b,()=>e.children),h(t),V(1,t,()=>M,()=>({duration:i})),V(2,t,()=>M,()=>({duration:i})),L(u,t)}),L(g,$)}),h(a),L(l,a),Q()}export{Gt as component,Rt as universal};
