import{f as ae,a as L,e as G,t as P,b as z,d as W,s as oe,i as Ce}from"../chunks/DtfDv_wI.js";import{b as Se,h as N,a as we,aN as ue,f as Ne,g as Oe,s as Ve,i as de,U as ee,ad as Z,w as fe,c as q,q as je,d as Te,ay as ve,ax as _e,aO as me,aJ as Fe,j as ge,p as D,T as Me,z as he,a0 as Le,aP as qe,aQ as De,R as H,J as U,K as p,O as h,Q as C,M as te,N as Q,m as o,X as pe,Z as x,v as w,aR as Re,Y as ze}from"../chunks/Bm65ZtBm.js";import{i as re}from"../chunks/CIg85Oj2.js";import{X as Ge,a as He,b as E,c as O,s as Ue,t as ye,d as Qe,A as Ye,C as Je,e as Xe}from"../chunks/CDi6QYOH.js";import{I as se,s as ne,c as Ze,i as Be,t as V,b as Ke,e as be,a as We,f as F}from"../chunks/8Bd8hmjO.js";import{_ as Y}from"../chunks/Dp1pzeXC.js";import{r as J,b as Ie,g as et,$ as Pe,a as $e,w as xe}from"../chunks/C9wcPKOd.js";import{p as le}from"../chunks/RMjvudXX.js";import{c as tt}from"../chunks/ByBdYZ_m.js";import{l as ie,s as ce,p as R}from"../chunks/RrunQH75.js";import{C as at}from"../chunks/gDen9nhZ.js";import{b as Ae,g as ot}from"../chunks/DY4oaM4j.js";const B=0,M=1,K=2;function rt(l,e,r,y,i){N&&we();var n=l,c=Le(),_=Fe,s=ee,d,a,m,g=(c?fe:he)(void 0),$=(c?fe:he)(void 0),T=!1;function k(v,S){T=!0,S&&(ve(f),_e(f),me(_));try{v===B&&r&&(d?ge(d):d=q(()=>r(n))),v===M&&y&&(a?ge(a):a=q(()=>y(n,g))),v!==B&&d&&D(d,()=>d=null),v!==M&&a&&D(a,()=>a=null),v!==K&&m&&D(m,()=>m=null)}finally{S&&(me(null),_e(null),ve(null),Me())}}var f=Se(()=>{if(s===(s=e()))return;let v=N&&ue(s)===(n.data===Ne);if(v&&(n=Oe(),Ve(n),de(!1),v=!0),ue(s)){var S=s;T=!1,S.then(u=>{S===s&&(Z(g,u),k(M,!0))},u=>{if(S===s)throw Z($,u),k(K,!0),$.v}),N?r&&(d=q(()=>r(n))):je(()=>{T||k(B,!0)})}else Z(g,s),k(M,!1);return v&&de(!0),()=>s=ee});N&&(n=Te)}function st(l,e,r){N&&we();var y=l,i=ee,n,c=Le()?qe:De;Se(()=>{c(i,i=e())&&(n&&D(n),n=q(()=>r(y)))}),N&&(y=Te)}const nt=!0,Rt=Object.freeze(Object.defineProperty({__proto__:null,prerender:nt},Symbol.toStringTag,{value:"Module"})),ke="en";J("en",()=>Y(()=>import("../chunks/ICEdU12j.js"),[],import.meta.url));J("fi",()=>Y(()=>import("../chunks/CH3oJwPu.js"),[],import.meta.url));J("sv",()=>Y(()=>import("../chunks/D2SZLOoF.js"),[],import.meta.url));J("sa",()=>Y(()=>import("../chunks/DS1uFp8_.js"),[],import.meta.url));Ie({fallbackLocale:ke,initialLocale:et()||ke});async function lt(){try{const e=await fetch("https://peacemachine.eu/auth/app-token",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Error ${e.status}: ${await e.text()}`);const r=await e.json();return localStorage.setItem("accessToken",r.access_token),localStorage.setItem("refreshToken",r.refresh_token),r}catch(l){return console.error("Error getting auth token:",l),null}}function it(l,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);se(l,ce({name:"globe"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(i,n)=>{var c=ae(),_=H(c);ne(_,e,"default",{}),L(i,c)},$$slots:{default:!0}}))}function ct(l,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);se(l,ce({name:"volume-2"},()=>r,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["path",{d:"M16 9a5 5 0 0 1 0 6"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728"}]],children:(i,n)=>{var c=ae(),_=H(c);ne(_,e,"default",{}),L(i,c)},$$slots:{default:!0}}))}function ut(l,e){const r=ie(e,["children","$$slots","$$events","$$legacy"]);se(l,ce({name:"volume-x"},()=>r,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15"}]],children:(i,n)=>{var c=ae(),_=H(c);ne(_,e,"default",{}),L(i,c)},$$slots:{default:!0}}))}var dt=(l,e)=>e.closeLangCard(),ft=(l,e,r)=>e(r()),vt=P("<button> </button>"),_t=P('<div class="card-lang-container svelte-dj9995"><div class="card-header-container svelte-dj9995"><button class="btn btn-close svelte-dj9995"><!></button></div> <div class="card-btn-container svelte-dj9995"></div> <div class="card-extra-container svelte-dj9995"><div class="card-checkmark-container svelte-dj9995"><!></div> <div> </div></div></div>');function mt(l,e){U(e,!0);const[r,y]=oe(),i=()=>z($e,"$locale",r),n=()=>z(Pe,"$_",r);let c=R(e,"translate",15);const _=[{code:"en",name:"English"},{code:"fi",name:"Suomi"},{code:"sv",name:"Svenska"},{code:"sa",name:"SÃ¡megiella"}];async function s(u){$e.set(u),localStorage.setItem("locale",u),await xe().then(()=>{e.closeLangCard(!1)})}var d=_t(),a=p(d),m=p(a);m.__click=[dt,e];var g=p(m);Ge(g,{color:"#ffffff"}),h(m),h(a);var $=C(a,2);Ze($,21,()=>_,Be,(u,t)=>{let b=()=>o(t).code,A=()=>o(t).name;var I=vt();let j;I.__click=[ft,s,b];var X=p(I,!0);h(I),te(Ee=>{j=tt(I,1,"btn btn-lang svelte-dj9995",null,j,Ee),W(X,A())},[()=>({"active-lang":i()===b()})]),L(u,I)}),h($);var T=C($,2),k=p(T),f=p(k);at(f,{get checkValue(){return c()},set checkValue(u){c(u)}}),h(k);var v=C(k,2),S=p(v,!0);h(v),h(T),h(d),te(u=>W(S,u),[()=>n()("btn_translate_check")]),L(l,d),Q(),y()}G(["click"]);G(["click"]);var gt=(l,e)=>e(),ht=P('<div class="audio-icon-container svelte-1hhaios"><button class="btn svelte-1hhaios"><!></button></div>');function pt(l,e){U(e,!0);const[r,y]=oe(),i=()=>z(He,"$audioStore",r);let n=R(e,"volume",11,.3),c=R(e,"clusterVolume",11,1),_=R(e,"fadeTime",11,500),s=x(0),d=x(-1),a=x(null),m=!1;async function g(){if(!m)try{m=!0;const b=!i().isGloballyMuted;if(E.setMuted(b),b){if(o(a)){const A=isFinite(_())?_():500;await O.fadeOut(o(a),A),E.setPlayingState("paused")}Ue.stopAllEffects()}else await $()}finally{m=!1}}async function $(){if(!(o(a)&&o(d)===o(s)&&!o(a).paused)){o(a)&&(O.cancelFade(o(a)),o(a).pause(),w(a,null));try{const t=isFinite(n())?n():.3,b=isFinite(_())?_():500;w(a,new Audio(ye[o(s)].src),!0),o(a).loop=!0,o(a).volume=0,await o(a).play(),await O.fadeIn(o(a),t,b),w(d,o(s),!0),E.setCurrentSong(o(a)),E.setPlayingState("playing"),E.setVolume(t)}catch(t){console.error("Failed to start playing song:",t),w(a,null),w(d,-1),E.setPlayingState("paused")}}}async function T(){if(!(!o(a)||m)){m=!0;try{const t=o(a),b=isFinite(n())?n():.3,A=isFinite(_())?_():500,I=new Audio(ye[o(s)].src);I.loop=!0,I.volume=0,await I.play();const j=O.fadeOut(t,A*.7),X=O.fadeIn(I,b,A*.7);await Promise.all([j,X]),w(a,I,!0),w(d,o(s),!0),E.setCurrentSong(I),E.setVolume(b)}catch(t){console.error("Cross-fade failed:",t),await $()}finally{m=!1}}}pe(()=>{const t=le.url.pathname==="/explore"?1:0;t!==o(s)&&!i().isGloballyMuted&&i().playingState==="playing"&&o(a)&&!m?(o(s),w(s,t,!0),T().catch(b=>{console.error("Failed to cross-fade to new song:",b),w(s,t,!0)})):w(s,t,!0)}),pe(()=>{const t=isFinite(c())?c():1;Qe.setClusterVolume(t)});var k=ht(),f=p(k);f.__click=[gt,g];var v=p(f);{var S=t=>{ut(t,{color:"#ffffff"})},u=t=>{ct(t,{color:"#ffffff"})};re(v,t=>{i().isGloballyMuted?t(S):t(u,!1)})}h(f),h(k),L(l,k),Q(),y()}G(["click"]);var yt=()=>ot(`${Ae}/`),bt=P('<div class="back-btn-container svelte-1sj945"><button class="btn svelte-1sj945"><!> </button></div>'),$t=(l,e)=>e.toggleLang(),kt=P('<div class="card-header-container svelte-1sj945"><!> <div class="lang-btn-container svelte-1sj945"><button class="btn svelte-1sj945"><!></button></div> <div class="audio-control-container svelte-1sj945"><!></div></div>');function St(l,e){U(e,!0);const[r,y]=oe(),i=()=>z(Pe,"$_",r);let n=x(.5),c=x(1),_=x(500);var s=kt(),d=p(s);{var a=f=>{var v=bt(),S=p(v);S.__click=[yt];var u=p(S);Ye(u,{color:"#ffffff"});var t=C(u);h(S),h(v),te(b=>W(t,` ${b??""}`),[()=>i()("btn_exit")]),V(3,v,()=>Ke),L(f,v)};re(d,f=>{le.url.pathname===`${Ae}/explore`&&f(a)})}var m=C(d,2),g=p(m);g.__click=[$t,e];var $=p(g);it($,{color:"#ffffff"}),h(g),h(m);var T=C(m,2),k=p(T);pt(k,{get volume(){return o(n)},set volume(f){w(n,f,!0)},get fadeTime(){return o(_)},set fadeTime(f){w(_,f,!0)},get clusterVolume(){return o(c)},set clusterVolume(f){w(c,f,!0)}}),h(T),h(s),L(l,s),Q(),y()}G(["click"]);var wt=P('<link rel="icon" type="image/svg" href="/favicon.ico">'),Tt=P('<div class="lang-container svelte-eqtc25"><!></div>'),Lt=P('<div class="page-container"><!></div>'),It=P('<!> <div class="header-container svelte-eqtc25"><!></div> <!>',1),Pt=P('<div class="app svelte-eqtc25"><!></div>');function zt(l,e){U(e,!0);let r=x(null),y=x(!1),i=500,n=x(!1);Re("questions",()=>o(r)),Ie({fallbackLocale:"en",initialLocale:"en"});const c=()=>({API_ENDPOINT:"/get_questions",API_METHOD:"POST",REQUEST_BODY:{question_type:"starter"}});async function _(){await lt().then(()=>{s()}).catch(g=>{throw be(500,"Failed to get token")})}async function s(){await We(c()).then(g=>{w(r,g,!0)}).catch(g=>{throw be(500,"Failed to get questions")})}let d=()=>{w(y,!o(y))};ze(()=>{window.scrollTo(0,0),_()});var a=Pt();Ce(g=>{var $=wt();L(g,$)});var m=p(a);rt(m,xe,g=>{Je(g)},g=>{var $=It(),T=H($);{var k=u=>{var t=Tt(),b=p(t);mt(b,{closeLangCard:d,get translate(){return o(n)},set translate(A){w(n,A,!0)}}),h(t),V(1,t,()=>F,()=>({duration:i})),V(2,t,()=>F,()=>({duration:i})),L(u,t)};re(T,u=>{o(y)&&u(k)})}var f=C(T,2),v=p(f);St(v,{toggleLang:d}),h(f);var S=C(f,2);st(S,()=>le.url.pathname,u=>{var t=Lt(),b=p(t);Xe(b,()=>e.children),h(t),V(1,t,()=>F,()=>({duration:i})),V(2,t,()=>F,()=>({duration:i})),L(u,t)}),L(g,$)}),h(a),L(l,a),Q()}export{zt as component,Rt as universal};
